<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Reactive Level Line</title>
	<style>
		* { box-sizing: border-box; }
		html, body { height: 100%; }
		body {
			margin: 0;
			font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
			background: #0f172a; /* slate-900 */
			color: #e5e7eb; /* gray-200 */
			touch-action: none;
			overflow: hidden;
		}

		.container {
			position: relative;
			width: 100vw;
			height: 100vh;
		}

		.center-guide { /* optional fixed center line */
			position: absolute;
			top: 50%;
			left: 0;
			width: 100%;
			height: 2px;
			transform: translateY(-50%);
			background: rgba(148,163,184,0.35);
		}

		.moving-line {
			position: absolute;
			top: 50%;
			left: 0;
			width: 100%;
			height: 4px;
			background: #9ca3af; /* gray-400 */
			border-radius: 2px;
			transform: translate3d(0, -50%, 0);
			transition: background-color 0.2s ease;
		}

		.header {
			position: absolute;
			top: 12px;
			left: 50%;
			transform: translateX(-50%);
			font-weight: 600;
			font-size: 16px;
			text-align: center;
			opacity: 0.9;
		}

		.overlay {
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			background: #111827;
			padding: 16px 20px;
			border-radius: 10px;
			box-shadow: 0 10px 30px rgba(0,0,0,0.35);
			text-align: center;
		}

		.button {
			appearance: none;
			border: none;
			background: #8b5cf6;
			color: white;
			padding: 10px 14px;
			border-radius: 8px;
			font-weight: 700;
			margin-top: 8px;
		}

		.debug { position: absolute; bottom: 10px; left: 10px; font-size: 12px; opacity: .6; }
	</style>
</head>
<body>
	<div class="container">
		<div class="header">Tilt phone: line centers when vertical; moves to edges when horizontal.</div>
		<div id="center" class="center-guide"></div>
		<div id="line" class="moving-line"></div>
		<div id="overlay" class="overlay">
			<div>Tap to enable motion sensors</div>
			<button id="enable" class="button">Enable Motion</button>
			<div style="margin-top:6px;font-size:12px;opacity:.75">Some browsers require a user gesture.</div>
		</div>
		<div id="dbg" class="debug" hidden></div>
	</div>

	<script>
		const line = document.getElementById('line');
		const overlay = document.getElementById('overlay');
		const enableBtn = document.getElementById('enable');
		const dbg = document.getElementById('dbg');

		const clamp = (v, lo, hi) => Math.min(hi, Math.max(lo, v));
		let eventCount = 0;
		let started = false;

		// Maps pitch to vertical position: vertical (|pitch|≈90°)=>50%; horizontal (pitch≈0°)=>0%/100%
		function updateFromPitch(pitchDeg) {
			// We want: vertical -> center (50%), horizontal -> edges (0%/100%).
			// pitchDeg here should be beta-like: 0≈horizontal, ±90≈vertical.
			const sign = Math.sign(pitchDeg) || 1; // negative -> move toward top
			const towardEdge = clamp(1 - Math.abs(pitchDeg) / 90, 0, 1); // 1 at horizontal, 0 at vertical
			const offset = sign * towardEdge * 50; // percent of container height
			const yPercent = clamp(50 + offset, 0, 100);
			line.style.top = yPercent + '%';
			line.style.transform = 'translate3d(0, -50%, 0)';
			dbg.textContent = `mapped beta/pitch: ${pitchDeg.toFixed(1)}°, y: ${yPercent.toFixed(1)}%`;
		}

		function onOrientation(e) {
			if (e.beta == null) return;
			// Normalize beta to [-180,180]
			let b = e.beta;
			// Convert to a value where 0≈horizontal, ±90≈vertical
			// distance from nearest vertical: v in [0,90]
			const v = 90 - Math.abs(Math.abs(b) - 90);
			// sign: which side to move (top vs bottom)
			const sign = b >= 0 ? 1 : -1;
			const mapped = sign * v; // keep sign for direction
			eventCount++;
			updateFromPitch(mapped);
		}

		// Some Android devices only fire deviceorientationabsolute
		function onOrientationAbsolute(e) {
			if (e.beta == null) return;
			eventCount++;
			onOrientation(e);
		}

		function onMotion(e) {
			const g = e.accelerationIncludingGravity;
			if (!g) return;
			const ax = g.x || 0; const ay = g.y || 0; const az = g.z || 0;
			// Pitch approximation from accelerometer with gravity
			const pitchRad = Math.atan2(-ax, Math.hypot(ay, az));
			// Convert so that 0≈horizontal, ±90≈vertical similar to beta mapping above
			const betaLike = (Math.abs(pitchRad) * 180 / Math.PI); // [0..90]
			const sign = pitchRad >= 0 ? -1 : 1; // approximate direction (device axes vary)
			eventCount++;
			updateFromPitch(sign * betaLike);
		}

		function start() {
			if (started) return; started = true;
			const needsPerm = window.DeviceOrientationEvent && typeof DeviceOrientationEvent.requestPermission === 'function';
			if (needsPerm) {
				DeviceOrientationEvent.requestPermission().then(state => {
					if (state === 'granted') {
						window.addEventListener('deviceorientation', onOrientation, true);
						window.addEventListener('deviceorientationabsolute', onOrientationAbsolute, true);
						window.addEventListener('devicemotion', onMotion, true);
						overlay.style.display = 'none';
						dbg.hidden = false;
					}
				}).catch(() => {});
			} else {
				window.addEventListener('deviceorientation', onOrientation, true);
				window.addEventListener('deviceorientationabsolute', onOrientationAbsolute, true);
				window.addEventListener('devicemotion', onMotion, true);
				overlay.style.display = 'none';
				dbg.hidden = false;
			}

			// Watchdog: if no events after 3s, show guidance
			setTimeout(() => {
				if (eventCount === 0) {
					overlay.style.display = 'block';
					overlay.innerHTML = '<div style="max-width:260px">No motion events detected. Open this page over HTTPS or on localhost, then tap Enable Motion. Some browsers block sensors on file:// URLs.</div>';
				}
			}, 3000);
		}

		enableBtn.addEventListener('click', start);
	</script>
</body>
</html>

