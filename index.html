<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tilt-Reactive Line</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles */
        body {
            font-family: 'Inter', sans-serif;
            touch-action: none; /* Prevents scrolling on touch devices */
        }
        #reactive-line {
            transition: top 0.1s ease-out;
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col h-screen overflow-hidden">

    <!-- Header -->
    <header class="bg-gray-800 shadow-lg w-full text-center p-4 z-10">
        <h1 class="text-2xl font-bold tracking-wider">Tilt-Reactive Line</h1>
    </header>

    <!-- Main Content Area -->
    <main id="main-content" class="relative flex-grow w-full max-w-2xl mx-auto flex flex-col justify-center items-center p-4">
        <!-- The reactive line that moves -->
        <div id="reactive-line" class="absolute h-1 w-full bg-cyan-400 rounded-full shadow-[0_0_15px_rgba(56,189,248,0.8)]" style="top: 50%;"></div>

        <!-- Onboarding and Data Display -->
        <div id="info-display" class="text-center z-10 bg-gray-900 bg-opacity-70 p-6 rounded-lg">
            <p id="instructions" class="text-lg mb-4">Click the button below to activate the motion sensors.</p>
            <button id="permission-btn" class="bg-cyan-500 hover:bg-cyan-600 text-white font-bold py-3 px-6 rounded-lg transition-transform transform hover:scale-105">
                Activate Sensors
            </button>
            <div id="data-container" class="hidden mt-4 text-sm text-gray-400">
                <p>Beta (Tilt Angle): <span id="beta-value" class="font-mono">...</span></p>
                <p id="error-message" class="text-red-400 mt-2"></p>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 shadow-lg w-full text-center p-4 z-10">
        <p class="text-sm text-gray-400">Tilt your device vertically. The line moves from top to bottom.</p>
    </footer>

    <script>
        const line = document.getElementById('reactive-line');
        const permissionBtn = document.getElementById('permission-btn');
        const instructions = document.getElementById('instructions');
        const dataContainer = document.getElementById('data-container');
        const betaValue = document.getElementById('beta-value');
        const errorMessage = document.getElementById('error-message');

        // This function sets up the event listener after permission is granted.
        function startListening() {
            window.addEventListener('deviceorientation', handleOrientation);
            permissionBtn.style.display = 'none';
            instructions.textContent = 'Now, tilt your phone!';
            dataContainer.classList.remove('hidden');
        }

        // The main function to handle device orientation changes.
        function handleOrientation(event) {
            // Beta is the front-to-back tilt.
            // Range is -180 to 180. We'll focus on the 0-180 range for simplicity.
            let beta = event.beta;

            // Handle potential null values for beta
            if (beta === null) {
                errorMessage.textContent = 'Could not read beta value from device.';
                return;
            }

            // Normalize beta to a 0-1 range (0 to 180 degrees)
            // 90 degrees (vertical) = 50%
            // 0 degrees (horizontal, facing up) = 0%
            // 180 degrees (horizontal, facing down) = 100%
            let percentage = beta / 180;

            // Clamp the value between 0 and 1 to prevent the line from going off-screen
            percentage = Math.max(0, Math.min(1, percentage));

            // Update the line's top position
            line.style.top = `${percentage * 100}%`;

            // Update the data display
            betaValue.textContent = Math.round(beta);
        }

        // Handle the permission button click
        permissionBtn.addEventListener('click', () => {
            // For iOS 13+ devices, we need to explicitly request permission.
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === 'granted') {
                            startListening();
                        } else {
                            errorMessage.textContent = 'Permission not granted. Please enable motion sensors in your browser settings.';
                        }
                    })
                    .catch(console.error);
            } else {
                // For other devices (like Android), we can just start listening.
                startListening();
            }
        });
    </script>
</body>
</html>
