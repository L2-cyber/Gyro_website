<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tilt-Reactive Line</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles */
        body {
            font-family: 'Inter', sans-serif;
            touch-action: none; /* Prevents scrolling on touch devices */
        }
        #reactive-line {
            transition: top 0.1s ease-out, background-color 0.3s ease, box-shadow 0.3s ease;
        }
        /* Style for when the line is perfectly aligned */
        #reactive-line.aligned {
            background-color: #4ade80; /* Tailwind's green-400 */
            box-shadow: 0 0 25px rgba(74, 222, 128, 0.9);
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col h-screen overflow-hidden">

    <!-- Header -->
    <header class="bg-gray-800 shadow-lg w-full text-center p-4 z-10">
        <h1 class="text-2xl font-bold tracking-wider">Tilt-Reactive Line</h1>
    </header>

    <!-- Main Content Area -->
    <main id="main-content" class="relative flex-grow w-full max-w-2xl mx-auto flex flex-col justify-center items-center p-4">
        <!-- The reactive line that moves -->
        <div id="reactive-line" class="absolute h-1 w-full bg-gray-400 rounded-full shadow-[0_0_15px_rgba(56,189,248,0.8)]" style="top: 50%;"></div>
        <!-- The alignment guide band and center line -->
        <div id="guide-band" class="absolute w-full bg-gray-600 bg-opacity-30 rounded" style="top: 50%; transform: translateY(-50%);"></div>
        
        <!--div id="guide-center" class="absolute h-0.5 w-full bg-gray-400" style="top: 50%; transform: translateY(-50%);"></div-->

        <!-- Onboarding and Data Display -->
        <div id="info-display" class="text-center z-10 bg-gray-900 bg-opacity-70 p-6 rounded-lg">
            <p id="instructions" class="text-lg mb-2">Tilt your phone to align the cyan line with the grey target.</p>
            <p id="alignment-status" class="text-2xl font-bold text-green-400 h-8 mb-2"></p>
            <div id="data-container" class="mt-4 text-sm text-gray-400">
                <p>Beta (Tilt Angle): <span id="beta-value" class="font-mono">...</span></p>
                <p id="error-message" class="text-red-400 mt-2"></p>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 shadow-lg w-full text-center p-4 z-10">
        <p class="text-sm text-gray-400">Tilt your device vertically. The line moves from top to bottom.</p>
    </footer>

    <script>
        const line = document.getElementById('reactive-line');
        const instructions = document.getElementById('instructions');
        const dataContainer = document.getElementById('data-container');
        const betaValue = document.getElementById('beta-value');
        const errorMessage = document.getElementById('error-message');
        const alignmentStatus = document.getElementById('alignment-status');
        const guideBand = document.getElementById('guide-band');
        const guideCenter = document.getElementById('guide-center');

        // Define a threshold for alignment (e.g., +/- 1.5 degrees from 90)
        const alignmentThreshold = 3.5;

        // Size the guide band to represent the full threshold range
        function sizeGuideBand() {
            const percentHeight = (alignmentThreshold * 2) / 180 * 100; // full range +/- threshold
            guideBand.style.height = `${percentHeight}%`;
        }

        // This function sets up the event listener after permission is granted.
        function startListening() {
            window.addEventListener('deviceorientation', handleOrientation);
        }

        // The main function to handle device orientation changes.
        function handleOrientation(event) {
            // Beta is the front-to-back tilt.
            let beta = event.beta;

            // Handle potential null values for beta
            if (beta === null) {
                errorMessage.textContent = 'Could not read beta value from device.';
                return;
            }

            const isAligned = beta > (90 - alignmentThreshold) && beta < (90 + alignmentThreshold);

            // Always compute the line position continuously so no angles are skipped
            // Normalize beta to a 0-1 range (0 to 180 degrees)
            let percentage = beta / 180;
            percentage = Math.max(0, Math.min(1, percentage));
            line.style.top = `${percentage * 100}%`;

            // Only toggle visual feedback; do not snap position
            if (isAligned) {
                line.classList.add('aligned');
                alignmentStatus.textContent = 'Perfectly Aligned!';
            } else {
                line.classList.remove('aligned');
                alignmentStatus.textContent = '';
            }

            // Update the data display with more precision
            betaValue.textContent = beta.toFixed(2);
        }

        // Auto-start on load. iOS may still require a user gesture; show guidance if blocked.
        document.addEventListener('DOMContentLoaded', () => {
            sizeGuideBand();
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === 'granted') {
                            startListening();
                            instructions.textContent = 'Tilt your phone to align the cyan line with the grey target.';
                        } else {
                            errorMessage.textContent = 'Motion permission blocked. On iOS, tap the address bar → AA → Website Settings → Allow Motion & Orientation Access, then reload.';
                        }
                    })
                    .catch(() => {
                        errorMessage.textContent = 'Unable to request motion permission. Please enable motion sensors in browser settings and reload.';
                    });
            } else {
                startListening();
            }
        });
    </script>
</body>
</html>



