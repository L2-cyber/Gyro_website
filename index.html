<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tilt-Reactive Line</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles */
        body {
            font-family: 'Inter', sans-serif;
            touch-action: none; /* Prevents scrolling on touch devices */
        }
        #reactive-line {
            transition: top 0.1s ease-out, background-color 0.3s ease, box-shadow 0.3s ease;
        }
        /* Style for when the line is perfectly aligned */
        #reactive-line.aligned {
            background-color: #4ade80; /* Tailwind's green-400 */
            box-shadow: 0 0 25px rgba(74, 222, 128, 0.9);
        }
    </style>
</head>
<body class="bg-gray-900 text-white flex flex-col h-screen overflow-hidden">

    <!-- Header -->
    <header class="bg-gray-800 shadow-lg w-full text-center p-4 z-10">
        <h1 class="text-2xl font-bold tracking-wider">Tilt-Reactive Line</h1>
    </header>

    <!-- Main Content Area -->
    <main id="main-content" class="relative flex-grow w-full max-w-2xl mx-auto flex flex-col justify-center items-center p-4">
        <!-- The reactive line that moves -->
        <div id="reactive-line" class="absolute h-1 w-full bg-gray-400 rounded-full shadow-[0_0_15px_rgba(56,189,248,0.8)]" style="top: 50%;"></div>
        <!-- The alignment guide band -->
        <div id="guide-band" class="absolute w-full bg-gray-600 bg-opacity-30 rounded" style="top: 50%; transform: translateY(-50%);"></div>

        <!-- Status square: starts grey, turns fully opaque purple when aligned -->
        <div id="status-square" class="z-10 w-24 h-24 rounded bg-gray-600 bg-opacity-70 transition-all duration-300 scale-100"></div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 shadow-lg w-full text-center p-4 z-10">
        <p class="text-sm text-gray-400">Tilt your device vertically. The line moves from top to bottom.</p>
    </footer>

    <script>
        const line = document.getElementById('reactive-line');
        const statusSquare = document.getElementById('status-square');
        const guideBand = document.getElementById('guide-band');
        

        // Define a threshold for alignment (e.g., +/- 1.5 degrees from 90)
        const alignmentThreshold = 3;

        // Size the guide band to represent the full threshold range
        function sizeGuideBand() {
            const percentHeight = (alignmentThreshold * 2) / 180 * 100; // full range +/- threshold
            guideBand.style.height = `${percentHeight}%`;
        }

        // This function sets up the event listener after permission is granted.
        function startListening() {
            window.addEventListener('deviceorientation', handleOrientation);
        }

        // The main function to handle device orientation changes.
        function handleOrientation(event) {
            // Beta is the front-to-back tilt.
            let beta = event.beta;

            // Handle potential null values for beta
            if (beta === null) { return; }

            const isAligned = beta > (90 - alignmentThreshold) && beta < (90 + alignmentThreshold);

            // Always compute the line position continuously so no angles are skipped
            // Normalize beta to a 0-1 range (0 to 180 degrees)
            let percentage = beta / 180;
            percentage = Math.max(0, Math.min(1, percentage));
            line.style.top = `${percentage * 100}%`;

            // Only toggle visual feedback; do not snap position
            if (isAligned) {
                line.classList.add('aligned');
                statusSquare.classList.remove('bg-gray-600', 'bg-opacity-70', 'scale-100');
                statusSquare.classList.add('bg-purple-700', 'bg-opacity-100', 'scale-110');
            } else {
                line.classList.remove('aligned');
                statusSquare.classList.remove('bg-purple-700', 'bg-opacity-100', 'scale-110');
                statusSquare.classList.add('bg-gray-600', 'bg-opacity-70', 'scale-100');
            }

            // No numeric display
        }

        // Auto-start on load. iOS may still require a user gesture; show guidance if blocked.
        document.addEventListener('DOMContentLoaded', () => {
            sizeGuideBand();
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission()
                    .then(permissionState => {
                        if (permissionState === 'granted') {
                            startListening();
                        } else {
                            console.warn('Motion permission blocked. On iOS, enable Motion & Orientation Access for this site and reload.');
                        }
                    })
                    .catch(() => {
                        console.warn('Unable to request motion permission. Enable motion sensors in browser settings and reload.');
                    });
            } else {
                startListening();
            }
        });
    </script>
</body>
</html>

